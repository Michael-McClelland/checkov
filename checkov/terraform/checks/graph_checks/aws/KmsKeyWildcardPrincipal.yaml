---
metadata:
  id: "CKV_AWS_33"
  name: "Ensure KMS key policy does not contain wildcard (*) principal"
  category: "IAM"
definition:
  and:
    - cond_type: "attribute"
      resource_types:
        - "aws_kms_key"
      attribute: "policy"
      operator: "exists"
    - cond_type: "attribute"
      resource_types:
        - "aws_kms_key"
      attribute: "policy.Statement[?(@.Effect == 'Allow')].Principal[*]"
      operator: "jsonpath_not_equals"
      value: "*"
    - cond_type: "attribute"
      resource_types:
        - "aws_kms_key"
      attribute: "policy.Statement[?(@.Effect == 'Allow')].Principal.AWS[*]"
      operator: "jsonpath_not_equals"
      value: "*"
    - cond_type: "attribute"
      resource_types:
        - "aws_kms_key"
      attribute: "policy.Statement[?(@.Effect == 'Allow' & @.Principal == '*')]"
      operator: "jsonpath_not_exists"